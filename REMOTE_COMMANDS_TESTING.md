# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ Fandomon

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

‚úÖ **–°–∏—Å—Ç–µ–º–∞ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –∞–∫—Ç–∏–≤–Ω–∞**

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∞–Ω–æ –Ω–∞ MQTT —Ç–æ–ø–∏–∫ `fandomon/commands` –∏ –≥–æ—Ç–æ–≤–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã.

## –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

–ò–∑ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```
10-20 15:50:06.970 D MqttClientManager: Connected to MQTT broker
10-20 15:50:06.970 D DataSyncService: ‚úÖ Connected to MQTT broker for commands
10-20 15:50:09.121 D DataSyncService: ‚úÖ Subscribed to commands topic: fandomon/commands
10-20 15:50:09.121 D MainActivity: ‚úÖ Subscribed to MQTT commands
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MQTT –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ mosquitto_pub (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

**macOS:**
```bash
brew install mosquitto
```

**Ubuntu/Debian:**
```bash
sudo apt-get install mosquitto-clients
```

**Windows:**
–°–∫–∞—á–∞–π—Ç–µ —Å https://mosquitto.org/download/

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. GET_STATUS - –ó–∞–ø—Ä–æ—Å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
```bash
mosquitto_pub -h <broker_url> -p 1883 \
  -u <username> -P <password> \
  -t "fandomon/commands" \
  -m '{"command":"GET_STATUS","timestamp":1729428000000}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ —Ç–æ–ø–∏–∫ `fandomon/status`
- –í –ª–æ–≥–∞—Ö: `COMMAND_GET_STATUS` event logged

### 2. FORCE_SYNC - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```bash
mosquitto_pub -h <broker_url> -p 1883 \
  -u <username> -P <password> \
  -t "fandomon/commands" \
  -m '{"command":"FORCE_SYNC","timestamp":1729428000000}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –í –ª–æ–≥–∞—Ö: `COMMAND_FORCE_SYNC` event logged

### 3. UPDATE_SETTINGS - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```bash
mosquitto_pub -h <broker_url> -p 1883 \
  -u <username> -P <password> \
  -t "fandomon/commands" \
  -m '{
    "command":"UPDATE_SETTINGS",
    "parameters":{
      "check_interval":"10",
      "status_interval":"30",
      "device_name":"Test Device"
    },
    "timestamp":1729428000000
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤—è—Ç—Å—è –Ω–∞ 10 –∏ 30 –º–∏–Ω—É—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ
- –ò–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ "Test Device"
- –í –ª–æ–≥–∞—Ö: `COMMAND_UPDATE_SETTINGS` event logged

### 4. RESTART_FANDOMAT - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Fandomat
```bash
mosquitto_pub -h <broker_url> -p 1883 \
  -u <username> -P <password> \
  -t "fandomon/commands" \
  -m '{"command":"RESTART_FANDOMAT","timestamp":1729428000000}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `am start -n com.tastamat.fandomat/.MainActivity`
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Fandomat –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
- –í –ª–æ–≥–∞—Ö: `COMMAND_RESTART_FANDOMAT` event logged

### 5. CLEAR_EVENTS - –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã —Å–æ–±—ã—Ç–∏–π
```bash
mosquitto_pub -h <broker_url> -p 1883 \
  -u <username> -P <password> \
  -t "fandomon/commands" \
  -m '{"command":"CLEAR_EVENTS","timestamp":1729428000000}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ —Å–æ–±—ã—Ç–∏—è —É–¥–∞–ª—è—Ç—Å—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –í –ª–æ–≥–∞—Ö: `COMMAND_CLEAR_EVENTS` event logged —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

### 6. RESTART_FANDOMON - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∞–º–æ–≥–æ Fandomon
```bash
mosquitto_pub -h <broker_url> -p 1883 \
  -u <username> -P <password> \
  -t "fandomon/commands" \
  -m '{"command":"RESTART_FANDOMON","timestamp":1729428000000}'
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Fandomon!

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –û—Ç–º–µ–Ω—è—Ç—Å—è –≤—Å–µ AlarmManager –∑–∞–¥–∞—á–∏
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤—Å–µ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è
- –í –ª–æ–≥–∞—Ö: `COMMAND_RESTART_FANDOMON` event logged

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥

### –ß–µ—Ä–µ–∑ ADB Logcat
```bash
# –§–∏–ª—å—Ç—Ä –ø–æ CommandHandler
adb logcat | grep CommandHandler

# –§–∏–ª—å—Ç—Ä –ø–æ –≤—Å–µ–º MQTT —Å–æ–±—ã—Ç–∏—è–º
adb logcat | grep -E "MQTT|Command|DataSyncService"

# –§–∏–ª—å—Ç—Ä —Ç–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
adb logcat | grep "Executing command"
```

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã

```
D CommandHandler: üéØ Executing command: GET_STATUS
D CommandHandler: üìä Executing GET_STATUS command
D CommandHandler: ‚úÖ GET_STATUS command executed successfully
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ MQTT

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- ‚úÖ MQTT –≤–∫–ª—é—á–µ–Ω (Enable MQTT = ON)
- ‚úÖ Broker URL —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ Port = 1883 (–∏–ª–∏ –≤–∞—à –ø–æ—Ä—Ç)
- ‚úÖ Username –∏ Password –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- ‚úÖ Commands Topic = `fandomon/commands` (–∏–ª–∏ –≤–∞—à —Ç–æ–ø–∏–∫)

## Troubleshooting

### –ö–æ–º–∞–Ω–¥—ã –Ω–µ –ø–æ–ª—É—á–∞—é—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MQTT:**
   ```bash
   adb logcat | grep "Connected to MQTT broker"
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ Connected to MQTT broker for commands`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Ç–æ–ø–∏–∫:**
   ```bash
   adb logcat | grep "Subscribed to commands"
   ```
   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ Subscribed to commands topic: fandomon/commands`

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–ø–∏–∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:**
   - –í –∫–æ–º–∞–Ω–¥–µ mosquitto_pub: `-t "fandomon/commands"`
   - –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: Commands Topic –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç JSON:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –¥–ª—è –æ–±–µ—Ä—Ç–∫–∏ JSON
   - –í–Ω—É—Ç—Ä–∏ JSON –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JSON —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω –≤–∞–ª–∏–¥–∞—Ç–æ—Ä

### –ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—É—á–∞—é—Ç—Å—è, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫:**
   ```bash
   adb logcat | grep -E "Error|Failed|‚ùå"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã:**
   - –ü–æ–ª–µ `command` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
   - Timestamp –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º (long)
   - Parameters –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º, –Ω–µ —Å—Ç—Ä–æ–∫–æ–π

### –ü—Ä–∏–º–µ—Ä –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:
```json
{"command":"get_status"}  ‚ùå (lowercase)
{"command":"GET_STATUS"}  ‚úÖ (uppercase)
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥:

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º:**
   - –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ª–æ–≥–∏–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥
   - –î–æ–±–∞–≤—å—Ç–µ UI –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —Ç–æ–ø–∏–∫–∏ `fandomon/events` –∏ `fandomon/status`
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–æ–±—ã—Ç–∏—è `COMMAND_*` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –∫–æ–º–∞–Ω–¥ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
   - –ù–∞–ø—Ä–∏–º–µ—Ä: `RESTART_FANDOMAT` –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `FANDOMAT_STOPPED`

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–∞–Ω–¥

```
MQTT Broker (mosquitto/HiveMQ/etc)
         ‚Üì
    Topic: fandomon/commands
         ‚Üì
   MqttClientManager.subscribe()
         ‚Üì
   DataSyncService.handleIncomingCommand()
         ‚Üì
   CommandHandler.parseCommand()
         ‚Üì
   CommandHandler.executeCommand()
         ‚Üì
   [Command execution with logging]
         ‚Üì
   Event logged to database
         ‚Üì
   Event sent to fandomon/events topic
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è UPDATE_SETTINGS

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|-----|----------|--------|
| `check_interval` | String (int) | –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ Fandomat (–º–∏–Ω—É—Ç—ã) | "5" |
| `status_interval` | String (int) | –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ (–º–∏–Ω—É—Ç—ã) | "15" |
| `device_name` | String | –ò–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ | "Warehouse Tablet 1" |

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MQTT —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π (username/password)
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TLS/SSL –¥–ª—è MQTT (–ø–æ—Ä—Ç 8883)
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Ç–æ–ø–∏–∫—É –∫–æ–º–∞–Ω–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞—É–¥–∏—Ç–∞

## –°—Ç–∞—Ç—É—Å

- ‚úÖ MQTT –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –∞–∫—Ç–∏–≤–Ω–∞
- ‚úÖ CommandHandler –≥–æ—Ç–æ–≤ –∫ –ø—Ä–∏–µ–º—É –∫–æ–º–∞–Ω–¥
- ‚úÖ –í—Å–µ 6 —Ç–∏–ø–æ–≤ –∫–æ–º–∞–Ω–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- üîÑ –û–∂–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
