# Обновление кнопок мониторинга

## Что изменилось

### Визуальное отображение состояния мониторинга

Теперь кнопки управления мониторингом показывают текущее состояние:

#### Когда мониторинг НЕ активен:
```
╔════════════════════════════════════╗
║ Monitoring Control                 ║
║                                    ║
║ ┌────────────────┐ ┌─────────────┐║
║ │ Start          │ │ Stop        │║
║ │ Monitoring     │ │ Monitoring  │║
║ │ (outlined)     │ │ (disabled)  │║
║ └────────────────┘ └─────────────┘║
╚════════════════════════════════════╝
```

#### Когда мониторинг активен:
```
╔════════════════════════════════════╗
║ Monitoring Control        ● Active ║
║                                    ║
║ ┌────────────────┐ ┌─────────────┐║
║ │ Monitoring     │ │ Stop        │║
║ │ Active         │ │ Monitoring  │║
║ │ (filled blue)  │ │ (red tonal) │║
║ └────────────────┘ └─────────────┘║
╚════════════════════════════════════╝
```

## Изменения в коде

### 1. Добавлено состояние в ViewModel

**Файл:** [SettingsViewModel.kt](app/src/main/java/com/tastamat/fandomon/ui/viewmodel/SettingsViewModel.kt)

```kotlin
data class SettingsState(
    // ... другие поля
    val isMonitoringActive: Boolean = false  // ← Новое поле
)
```

Теперь при нажатии на кнопки:
- **Start Monitoring** → `isMonitoringActive = true`
- **Stop Monitoring** → `isMonitoringActive = false`

### 2. Обновлен UI кнопок

**Файл:** [SettingsScreen.kt](app/src/main/java/com/tastamat/fandomon/ui/screen/SettingsScreen.kt)

#### Добавлен индикатор статуса

В заголовке карточки появляется индикатор "● Active" когда мониторинг работает:

```kotlin
if (state.isMonitoringActive) {
    Row {
        Surface(
            modifier = Modifier.size(8.dp),
            color = MaterialTheme.colorScheme.primary
        ) {}
        Text("Active", color = MaterialTheme.colorScheme.primary)
    }
}
```

#### Кнопка Start Monitoring

**Когда НЕ активен:**
- Стиль: `OutlinedButton` (обведена контуром)
- Текст: "Start Monitoring"
- Цвет: стандартный
- Состояние: доступна для нажатия

**Когда активен:**
- Стиль: `Button` (заполнена цветом)
- Текст: "Monitoring Active"
- Цвет: синий (primary color)
- Состояние: доступна для нажатия (перезапуск мониторинга)

#### Кнопка Stop Monitoring

**Когда НЕ активен:**
- Стиль: `OutlinedButton` (обведена контуром)
- Текст: "Stop Monitoring"
- Цвет: серый
- Состояние: **отключена** (`enabled = false`)

**Когда активен:**
- Стиль: `FilledTonalButton` (заполнена тональным цветом)
- Текст: "Stop Monitoring"
- Цвет: красный (errorContainer)
- Состояние: доступна для нажатия

## Поведение

### При запуске приложения
- По умолчанию: `isMonitoringActive = false`
- Кнопка Start - обведена контуром
- Кнопка Stop - отключена

### После нажатия "Start Monitoring"
1. Запускаются алармы мониторинга
2. `isMonitoringActive = true`
3. Кнопка Start становится синей и показывает "Monitoring Active"
4. Кнопка Stop становится активной и красной
5. Появляется индикатор "● Active"

### После нажатия "Stop Monitoring"
1. Отменяются все алармы
2. `isMonitoringActive = false`
3. Кнопка Start возвращается к обведенному стилю
4. Кнопка Stop отключается
5. Индикатор "● Active" исчезает

### Переоткрытие приложения

**Проблема:** Состояние `isMonitoringActive` сбрасывается при перезапуске приложения.

**Решение (опционально):** Можно сохранять состояние в SharedPreferences:

```kotlin
// В AppPreferences.kt добавить:
val isMonitoringActive: Flow<Boolean> = dataStore.data.map { it[MONITORING_ACTIVE_KEY] ?: false }

suspend fun setMonitoringActive(active: Boolean) {
    dataStore.edit { it[MONITORING_ACTIVE_KEY] = active }
}

companion object {
    private val MONITORING_ACTIVE_KEY = booleanPreferencesKey("monitoring_active")
}
```

Но это не обязательно, так как:
- Алармы сохраняются в системе даже после перезапуска приложения
- Пользователь может просто посмотреть логи или нажать Start снова

## Преимущества новой реализации

### 1. Визуальная обратная связь
- ✅ Пользователь сразу видит, работает мониторинг или нет
- ✅ Цветовое кодирование (синий = активен, красный = остановить)
- ✅ Индикатор статуса "● Active"

### 2. Предотвращение ошибок
- ✅ Нельзя остановить мониторинг, если он не запущен
- ✅ Кнопка Stop отключена когда мониторинг не активен

### 3. Улучшенный UX
- ✅ Понятно текущее состояние системы
- ✅ Можно перезапустить мониторинг нажав Start снова
- ✅ Четкое разделение: синяя = работает, красная = остановить

### 4. Material Design 3
- ✅ Использует современные компоненты M3
- ✅ `FilledTonalButton` для Stop (мягкий красный)
- ✅ Адаптивная цветовая схема

## Тестирование

### Тест 1: Запуск мониторинга
```
1. Открыть приложение
2. Кнопка Start должна быть обведена контуром
3. Кнопка Stop должна быть серой и отключенной
4. Нажать Start Monitoring
5. ✅ Кнопка Start становится синей с текстом "Monitoring Active"
6. ✅ Кнопка Stop становится активной красной
7. ✅ Появляется индикатор "● Active"
```

### Тест 2: Остановка мониторинга
```
1. При активном мониторинге
2. Нажать Stop Monitoring
3. ✅ Кнопка Start возвращается к outline стилю
4. ✅ Кнопка Stop становится серой и отключенной
5. ✅ Индикатор "● Active" исчезает
```

### Тест 3: Перезапуск мониторинга
```
1. При активном мониторинге
2. Нажать на "Monitoring Active"
3. ✅ Алармы перепланируются
4. ✅ Кнопка остается синей
5. ✅ Статус остается "Active"
```

## Скриншоты состояний

### Состояние 1: Мониторинг выключен
```
┌─────────────────────────────────────┐
│ Monitoring Control                  │
│                                     │
│ ┌─────────────┐  ┌────────────────┐│
│ │   Start     │  │      Stop      ││
│ │ Monitoring  │  │   Monitoring   ││
│ │  (outline)  │  │   (disabled)   ││
│ └─────────────┘  └────────────────┘│
└─────────────────────────────────────┘
```

### Состояние 2: Мониторинг включен
```
┌─────────────────────────────────────┐
│ Monitoring Control        ● Active  │
│                                     │
│ ┌─────────────┐  ┌────────────────┐│
│ │ Monitoring  │  │      Stop      ││
│ │   Active    │  │   Monitoring   ││
│ │   (blue)    │  │     (red)      ││
│ └─────────────┘  └────────────────┘│
└─────────────────────────────────────┘
```

## Цветовая схема

| Элемент | Состояние | Цвет | Значение |
|---------|-----------|------|----------|
| Start button | Inactive | Outline | Можно запустить |
| Start button | Active | Primary (Blue) | Работает |
| Stop button | Inactive | Grey (disabled) | Нечего останавливать |
| Stop button | Active | Error Container (Red) | Можно остановить |
| Status indicator | Active | Primary (Blue) | Статус "работает" |

## Будущие улучшения

### Опция 1: Сохранение состояния
Сохранять `isMonitoringActive` в DataStore для восстановления после перезапуска

### Опция 2: Время последней проверки
Показывать под кнопками:
```
Last check: 2 minutes ago
Next check: in 3 minutes
```

### Опция 3: Статистика
Показывать счетчик выполненных проверок:
```
Monitoring Active (42 checks today)
```

## Заключение

Теперь интерфейс управления мониторингом:
- ✅ Показывает текущее состояние визуально
- ✅ Предотвращает ошибки пользователя
- ✅ Использует цветовое кодирование
- ✅ Соответствует Material Design 3
- ✅ Улучшает пользовательский опыт
